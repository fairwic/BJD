# BJD App 业务逻辑全景图

本文档通过 Mermaid 图表详细展示了 BJD 应用程序的完整业务逻辑，涵盖了**用户（买家）**、**团长（组织者）**和**商家（卖家）**三个核心角色的全生命周期。

## 1. 用户 (买家) 生命周期
从发现商品到收货的全过程，包含特色的“转单”功能。

```mermaid
graph TD
    User((用户/买家))
    
    subgraph "发现阶段"
    User -->|微信一键登录| Login[登录 & 绑定手机号]
    Login --> Browse[浏览会员购/广场]
    Browse -->|"筛选: 尺寸/类型"| Search[找到心仪商品]
    end

    subgraph "参与团购"
    Search -->|加入团购| SelectSKU["选择SKU: 肤色/尺寸"]
    SelectSKU --> PayDeposit[支付定金]
    PayDeposit -->|上传支付截图| WaitVerify[等待团长审核]
    WaitVerify -->|审核通过| Contract[签署电子合同]
    end

    subgraph "漫长的等待 (工期)"
    Contract --> Production["制作期 (3-6个月)"]
    Production -->|查看状态| CheckProgress[查看进度更新]
    
    %% 转单循环
    CheckProgress -.->|"等不及了?"| TransferStart{发起转单?}
    TransferStart -->|是| GenLink[生成转单链接]
    GenLink --> ShareLink[分享给新买家]
    ShareLink -->|新买家支付| TransferDone[订单所有权转移]
    end

    subgraph "履约收货"
    Production -->|通知| FinalCall[收到补款通知]
    FinalCall --> PayFinal[支付尾款 + 运费]
    PayFinal -->|上传截图| WaitShip[等待发货]
    WaitShip --> Receive[确认收货]
    Receive --> Review["评价 & 晒图"]
    end
```

## 2. 团长 (组织者) 生命周期
管理复杂的团购流程，从 Excel 导入到发货。

```mermaid
graph TD
    Leader((团长))

    subgraph "开团准备"
    Leader -->|认证| RealName[实名认证]
    RealName --> Create[创建团购]
    Create -->|"方式 A"| Manual["手动录入: 图片/SKU"]
    Create -->|"方式 B"| Import[一键导入 Excel 订单表]
    Import -->|系统解析| Invite[短信自动邀请买家]
    end

    subgraph "订单管理"
    Invite --> Monitor[监控定金进度]
    Monitor -->|审核截图| VerifyPayment[确认收款]
    VerifyPayment -->|锁定订单| SubmitFactory[向娃社/工厂下单]
    end

    subgraph "制作阶段"
    SubmitFactory --> Update[更新进度]
    Update -->|"例如: 正在打磨"| NotifyUsers[通知买家]
    Update -->|"延期?"| Broadcast[群发延期公告]
    end

    subgraph "履约阶段"
    Update -->|制作完成| TriggerFinal[触发补款通知]
    TriggerFinal -->|追踪| CheckFinalPay[核对尾款]
    CheckFinalPay -->|已付| ExportShip[导出快递发货单]
    CheckFinalPay -->|未付| Chase[发送短信催付]
    Chase -->|死单| Blacklist["标记跑单 / 拉黑"]
    ExportShip --> Ship[发货]
    end
```

## 3. 商家 (卖家) 生命周期
现货商品的简化销售流程。

```mermaid
graph TD
    Merchant((商家))

    subgraph "店铺设置"
    Merchant -->|认证| Verify["企业/商家认证"]
    Verify --> List[发布现货商品]
    List --> Inventory[库存管理]
    end

    subgraph "交易流程"
    Inventory -->|用户下单| NewOrder[收到新订单]
    NewOrder -->|全款支付| Pack[打包发货]
    Pack --> Ship[快递发货]
    Ship -->|录入单号| Tracking[更新物流信息]
    end

    subgraph "售后"
    Tracking -->|用户签收| Complete[订单完成]
    Complete -->|结算| Withdraw[提现]
    end
```

## 4. 核心交互闭环

### “防跑单”机制
系统如何保护团长，防止用户弃单。

```mermaid
sequenceDiagram
    participant User as 用户
    participant System as 系统
    participant Leader as 团长
    participant Database as 信用库

    Leader->>System: 触发补款通知
    System->>User: 发送微信服务通知/短信
    
    loop 自动催付
        System->>User: 第3天提醒
        System->>User: 第7天提醒
    end

    alt 用户支付
        User->>System: 支付尾款 & 上传截图
        System->>Leader: 通知收款
        Leader->>System: 确认
        System->>Database: 记录“良好信用”
    else 用户失联 (跑单)
        System->>Leader: 警告“超期未付”
        Leader->>System: 标记为“跑单”
        System->>Database: 记录“跑单”状态
        Database-->>System: 加入黑名单
        System->>User: 限制账号功能
    end
```

### “转单”机制 (Killer Feature)
用户如何安全地转让名额，无需打扰团长。

```mermaid
sequenceDiagram
    participant Seller as 卖家 (用户A)
    participant Buyer as 买家 (用户B)
    participant System as 系统
    participant Leader as 团长

    Seller->>System: 申请转单 (订单 #123)
    System->>Seller: 生成唯一转单链接
    Seller->>Buyer: 分享链接 (闲鱼/微博)
    
    Buyer->>System: 访问链接 & 查看订单详情
    Buyer->>System: 支付定金金额 (给用户A)
    
    Note over System: 资金直接流向用户A (回血)
    
    System->>System: 转移订单所有权 #123: A -> B
    System->>Leader: 通知: 订单 #123以此易主
    
    Note over Leader: 团长无需手动修改Excel!
    
    Leader->>System: (未来发货) 直接发给用户B
```
