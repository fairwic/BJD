# 14 搜索与首页

## 概述
搜索与首页模块是平台的核心流量入口，包含轮播图运营位、商品搜索、热门推荐等功能。

**优先级**：P0 (Core/MVP)

**包含页面/组件**：
- `UserShop.jsx` - 首页/养娃Tab（轮播图集成）
- `SearchPage.jsx` - 搜索页面
- `Carousel.jsx` - 可复用轮播图组件

---

## 1. 轮播图组件 (`Carousel.jsx`)

### 1.1 功能定位
首页顶部运营位，用于展示热门团购、活动推广、妆师推荐等内容。

### 1.2 组件结构
```
┌─────────────────────────────┐
│  [渐变背景 + 装饰元素]        │
│                             │
│  [角标] 🔥本周热团           │
│  标题文字                    │
│  副标题/描述                 │
│                      ●○○   │
│                   (指示器)   │
└─────────────────────────────┘
```

### 1.3 组件Props

| 属性 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| items | Array | ✓ | [] | 轮播项数组 |
| autoPlay | boolean | ✗ | true | 是否自动播放 |
| interval | number | ✗ | 3000 | 播放间隔(ms) |
| onItemClick | function | ✗ | - | 点击回调 |

### 1.4 轮播项数据结构

```javascript
{
    id: 'banner_001',
    title: '鹿神·特体二样',
    subtitle: '神性与野性的完美结合',
    badge: '🔥 本周热团',
    gradient: 'from-purple-500 to-indigo-600',
    image: 'https://...', // 可选背景图
    type: 'group_buy', // group_buy | spot | artist | activity
    targetId: 'product_123', // 跳转目标ID
    targetUrl: 'WishPool' // 或跳转路由名
}
```

### 1.5 交互行为

| 操作 | 系统响应 |
|------|----------|
| 自动播放 | 每interval毫秒切换下一张 |
| 左滑 | 切换到下一张 |
| 右滑 | 切换到上一张 |
| 点击 | 调用onItemClick(item) |
| 点击指示器 | 跳转到指定张 |

### 1.6 跳转逻辑

根据轮播项的`type`字段决定跳转目标：

| type | 跳转页面 | 参数 |
|------|----------|------|
| group_buy | ProductDetail | { id: targetId } |
| spot | ProductDetail | { id: targetId } |
| artist | ArtistProfile | { artistId: targetId } |
| activity | targetUrl指定的路由 | - |

---

## 2. 首页集成 (`UserShop.jsx`)

### 2.1 轮播图位置
```
┌─────────────────────────────┐
│  [搜索框]            [许愿] │
│  [🔥热门] [3分] [4分] ...   │
├─────────────────────────────┤
│  [推荐][整娃][娃衣][眼珠]   │
├─────────────────────────────┤
│  ┌───────────────────────┐  │
│  │  [轮播图 Carousel]     │  │ ← 仅「推荐」分类显示
│  └───────────────────────┘  │
├─────────────────────────────┤
│  [现货市集]  |  [开团广场]   │
├─────────────────────────────┤
│  商品瀑布流...              │
└─────────────────────────────┘
```

### 2.2 轮播图数据源

轮播图数据来自 `MOCK_BANNERS`（后续接API）：

```javascript
const MOCK_BANNERS = [
    {
        id: 'banner_001',
        title: '鹿神·特体二样',
        subtitle: '神性与野性的完美结合，382人已上车',
        badge: '🔥 本周热团',
        gradient: 'from-purple-500 to-indigo-600',
        type: 'group_buy',
        targetId: 101
    },
    {
        id: 'banner_002',
        title: '妆师招募中',
        subtitle: '成为平台认证大师',
        badge: '✨ 限时活动',
        gradient: 'from-rose-400 to-pink-500',
        type: 'activity',
        targetUrl: 'ArtistApply'
    },
    // ...
];
```

---

## 3. 搜索页面 (`SearchPage.jsx`)

### 3.1 功能定位
独立搜索页面，提供热门搜索、历史记录、分类筛选、品牌筛选等功能。

### 3.2 页面结构
```
┌─────────────────────────────┐
│ [<] [搜索输入框]      [搜索] │
├─────────────────────────────┤
│  快捷筛选                    │
│  [全部][商家][团长][3分]...  │
├─────────────────────────────┤
│  🔥 热门搜索                 │
│  ┌────┐┌────┐┌────┐        │
│  │1龙魂││2 AS││3 MK│        │
│  │ 🔥 ││ ↑  ││ ↓  │        │
│  └────┘└────┘└────┘        │
│  4.Volks  5.DollPamm ...   │
├─────────────────────────────┤
│  🕐 历史搜索           [清空]│
│  龙魂 | 3分娃 | 古风妆面     │
├─────────────────────────────┤
│  📦 分类                     │
│  ┌────┐┌────┐┌────┐        │
│  │🎎  ││👗  ││👁️  │        │
│  │整娃 ││娃衣 ││眼珠 │        │
│  │128 ││256 ││89  │        │
│  └────┘└────┘└────┘        │
├─────────────────────────────┤
│  🏷️ 热门品牌                 │
│  🐲龙魂 | ✨AS | 🌟Volks... │
└─────────────────────────────┘
```

### 3.3 用户操作流程

#### 场景A：搜索商品

| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击首页搜索框 | 跳转SearchPage -> 自动聚焦输入框 |
| 2 | 输入关键词 | 实时显示输入内容 |
| 3 | 点击「搜索」或回车 | 执行搜索 -> 保存到历史 -> 返回首页并筛选 |
| 4 | 点击「×」清空 | 清空输入框 |

#### 场景B：快捷搜索

| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击热门搜索词 | 自动填入 -> 执行搜索 |
| 2 | 点击历史记录词 | 自动填入 -> 执行搜索 |
| 3 | 点击分类卡片 | 按分类筛选 -> 返回首页 |
| 4 | 点击品牌标签 | 按品牌筛选 -> 返回首页 |

#### 场景C：历史管理

| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击「清空」 | 弹窗确认 -> 清空历史记录 |
| 2 | 确认清空 | localStorage清除 -> 列表清空 |

### 3.4 热门搜索

| 排名 | 样式 | 说明 |
|------|------|------|
| 1-3 | 金/银/铜色背景 | 带火焰图标 |
| 4-10 | 普通样式 | 显示趋势箭头(↑/↓/−) |

趋势类型：
- `up`: 绿色上升箭头
- `down`: 红色下降箭头
- `stable`: 灰色横线

### 3.5 分类列表

| 分类 | 图标 | 颜色主题 |
|------|------|----------|
| 整娃 | 🎎 | rose-pink |
| 娃衣 | 👗 | purple-violet |
| 眼珠 | 👁️ | blue-cyan |
| 假发 | 💇 | amber-yellow |
| 配件 | 🎀 | green-emerald |
| 改妆 | 💄 | pink-rose |
| 素体 | 🦴 | gray-slate |

### 3.6 品牌列表

显示热门BJD品牌，hot标记的品牌带火焰图标：

```javascript
const BRANDS = [
    { id: 'longhun', name: '龙魂', logo: '🐲', hot: true },
    { id: 'as', name: 'AS', logo: '✨', hot: true },
    { id: 'volks', name: 'Volks', logo: '🌟', hot: true },
    { id: 'dollpamm', name: 'DollPamm', logo: '🌸', hot: false },
    // ...
];
```

---

## 后端逻辑要点

### 数据模型

```sql
-- 轮播图表
CREATE TABLE banners (
    id ULID PRIMARY KEY,
    title VARCHAR(50) NOT NULL,
    subtitle VARCHAR(100),
    badge VARCHAR(20),
    gradient VARCHAR(100),
    image VARCHAR(500),
    type VARCHAR(20) NOT NULL, -- group_buy, spot, artist, activity
    target_id VARCHAR(50),
    target_url VARCHAR(100),
    sort_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    start_at TIMESTAMPTZ,
    end_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 热门搜索表
CREATE TABLE hot_searches (
    id ULID PRIMARY KEY,
    keyword VARCHAR(50) NOT NULL,
    search_count INT DEFAULT 0,
    trend VARCHAR(10) DEFAULT 'stable', -- up, down, stable
    rank INT,
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 用户搜索历史(客户端存储，服务端可选)
-- 使用localStorage: search_history = ["龙魂", "3分娃", ...]
```

### API 设计

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/banners` | GET | 获取轮播图列表 |
| `/api/v1/hot-searches` | GET | 获取热门搜索词 |
| `/api/v1/search` | GET | 搜索商品(keyword/category/brand) |
| `/api/v1/categories` | GET | 获取分类列表 |
| `/api/v1/brands` | GET | 获取品牌列表(支持hot筛选) |

### 注意事项

1. **轮播图缓存**：
   - Redis缓存轮播图数据，5分钟TTL
   - 支持定时上下架(start_at/end_at)

2. **热门搜索**：
   - 每小时统计搜索词频次
   - 异步更新排名和趋势
   - 过滤敏感词

3. **搜索历史**：
   - 客户端localStorage存储
   - 最多保存20条
   - 新搜索词插入头部，去重

4. **搜索优化**：
   - 接入Elasticsearch
   - 支持拼音、同义词、品牌别名
   - 搜索词自动补全
