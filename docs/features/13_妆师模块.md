# 13 妆师模块

## 概述
妆师模块是平台服务市场的核心功能，支持用户浏览、筛选妆师/毛娘，查看作品集、服务项目和评价，并进行预约服务。

**优先级**：P0 (Core/MVP)

**包含页面**：
- `ArtistHub.jsx` - 妆师大厅（Tab页）
- `ArtistProfile.jsx` - 妆师主页
- `ArtistApply.jsx` - 妆师入驻申请（见12_入驻体系.md）

---

## 1. 妆师大厅 (`ArtistHub.jsx`)

### 1.1 功能定位
妆师服务的流量入口，采用Tab页形式，展示平台认证的妆师和毛娘列表。

### 1.2 页面结构
```
┌─────────────────────────────┐
│  [搜索框] 搜索妆师/毛娘...   │
├─────────────────────────────┤
│  [轮播Banner]               │
│  妆师招募中 / 新晋认证大师   │
├─────────────────────────────┤
│  [全部] [妆师] [毛娘]        │
├─────────────────────────────┤
│  [全部][古风][现代][日系]... │
│  (风格标签横滑)              │
├─────────────────────────────┤
│  ┌───────────────────────┐  │
│  │ [头像] 云墨妆坊 ✓认证  │  │
│  │ 🎨妆师 · 古风/清冷     │  │
│  │ ⭐4.9(128) | 256服务   │  │
│  │ ¥300-800              │  │
│  │ 🟢接单中               │  │
│  │ [作品缩略图x3]         │  │
│  └───────────────────────┘  │
│  ...更多妆师卡片            │
└─────────────────────────────┘
```

### 1.3 用户操作流程

| 操作 | 系统响应 |
|------|----------|
| 点击搜索框 | 聚焦输入 -> 实时过滤(防抖300ms) |
| 切换类型Tab | 过滤「全部/妆师/毛娘」 |
| 点击风格标签 | 按风格筛选，可多选 |
| 点击妆师卡片 | 跳转ArtistProfile(artistId) |
| 下拉刷新 | 重新加载列表 |

### 1.4 大师类型

| 类型 | 标识 | 服务内容 |
|------|------|----------|
| 妆师 | 🎨 | 娃娃面部妆容绘制 |
| 毛娘 | ✂️ | 假发制作、植毛、造型 |

### 1.5 状态标识

| 状态 | 颜色 | 含义 |
|------|------|------|
| available | 🟢绿色 | 接单中，可直接预约 |
| busy | 🟡黄色 | 排队中，显示预计等待时间 |
| offline | ⚪灰色 | 暂不接单 |

### 1.6 UI/UX 细节

| 元素 | 规格 |
|------|------|
| 卡片布局 | 白色圆角(16px) + 阴影 |
| 头像 | 48x48 圆角方形，渐变背景 |
| 认证标识 | 蓝色小盾牌 + "认证" |
| 作品缩略图 | 3张横排，圆角，可滑动查看更多 |
| 评分 | 星星图标 + 数字 + (评价数) |

---

## 2. 妆师主页 (`ArtistProfile.jsx`)

### 2.1 功能定位
展示妆师详细信息、作品集、服务项目、评价，支持关注和预约服务。

### 2.2 页面结构
```
┌─────────────────────────────┐
│ [<]      大师主页     [分享] │
├─────────────────────────────┤
│  [大头像]                    │
│  云墨妆坊 [✓认证]            │
│  🎨妆师 · 古风/清冷          │
│  🟢接单中                    │
├─────────────────────────────┤
│  256服务 | ⭐4.9评分 | 128评价│
├─────────────────────────────┤
│  个人简介...                 │
├─────────────────────────────┤
│  [+ 关注] 按钮               │
├─────────────────────────────┤
│  [作品集] | [服务项目] | [评价]│
├─────────────────────────────┤
│  (Tab内容区)                 │
├─────────────────────────────┤
│  [私聊]      [预约服务]      │ (底部固定)
└─────────────────────────────┘
```

### 2.3 Tab内容

#### 作品集Tab
```
┌───────┐ ┌───────┐
│ 古风  │ │ 清冷  │
│ 仙侠  │ │ 御姐  │
│ ❤️234 │ │ ❤️189 │
└───────┘ └───────┘
(2列网格布局)
```

#### 服务项目Tab
```
┌─────────────────────────────┐
│  基础妆面         ¥300      │
│  眉眼唇腮基础妆              │
├─────────────────────────────┤
│  精细妆面         ¥500      │
│  含睫毛+细节描绘             │
├─────────────────────────────┤
│  大师妆面         ¥800      │
│  定制风格+全脸精修           │
└─────────────────────────────┘
```

#### 评价Tab
```
┌─────────────────────────────┐
│  [头像] 娃娃控  ⭐⭐⭐⭐⭐    │
│  妆面超级精致！细节处理太棒   │
│  2024-12-15                 │
└─────────────────────────────┘
```

### 2.4 用户操作流程

| 操作 | 系统响应 |
|------|----------|
| 点击「关注」 | 按钮变为「已关注」-> 调用API |
| 点击作品图 | 全屏预览大图，支持左右滑动 |
| 点击「私聊」 | 跳转聊天页面，与妆师对话 |
| 点击「预约服务」 | 弹窗选择服务项目 -> 填写预约信息 |
| 点击服务项目「咨询」 | 跳转私聊，带入服务名称 |

### 2.5 预约流程

| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击「预约服务」 | 弹出服务项目选择面板 |
| 2 | 选择服务项目 | 高亮选中项，显示价格 |
| 3 | 填写预约信息 | 备注需求、联系方式 |
| 4 | 确认预约 | 提交API -> Toast"预约已提交" |
| 5 | 等待确认 | 妆师确认后推送通知 |

---

## 后端逻辑要点

### 数据模型

```sql
-- 妆师/毛娘表
CREATE TABLE artists (
    id ULID PRIMARY KEY,
    user_id ULID NOT NULL UNIQUE,
    type VARCHAR(20) NOT NULL, -- makeup, wig
    name VARCHAR(50) NOT NULL,
    avatar VARCHAR(500),
    bio TEXT,
    styles JSONB, -- ["古风", "清冷"]
    status VARCHAR(20) DEFAULT 'offline', -- available, busy, offline
    wait_time VARCHAR(50), -- "约2周"
    rating DECIMAL(2,1) DEFAULT 5.0,
    review_count INT DEFAULT 0,
    service_count INT DEFAULT 0,
    verified BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 服务项目表
CREATE TABLE artist_services (
    id ULID PRIMARY KEY,
    artist_id ULID NOT NULL,
    name VARCHAR(50) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    description VARCHAR(200),
    sort_order INT DEFAULT 0
);

-- 作品集表
CREATE TABLE artist_portfolios (
    id ULID PRIMARY KEY,
    artist_id ULID NOT NULL,
    title VARCHAR(50),
    image VARCHAR(500) NOT NULL,
    likes INT DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 预约表
CREATE TABLE artist_bookings (
    id ULID PRIMARY KEY,
    artist_id ULID NOT NULL,
    user_id ULID NOT NULL,
    service_id ULID NOT NULL,
    note TEXT,
    status VARCHAR(20) DEFAULT 'pending', -- pending, confirmed, completed, cancelled
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 评价表
CREATE TABLE artist_reviews (
    id ULID PRIMARY KEY,
    artist_id ULID NOT NULL,
    user_id ULID NOT NULL,
    booking_id ULID,
    rating INT NOT NULL CHECK (rating >= 1 AND rating <= 5),
    content TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### API 设计

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/artists` | GET | 妆师列表(支持type/style筛选) |
| `/api/v1/artists/{id}` | GET | 妆师详情 |
| `/api/v1/artists/{id}/portfolios` | GET | 作品集 |
| `/api/v1/artists/{id}/services` | GET | 服务项目 |
| `/api/v1/artists/{id}/reviews` | GET | 评价列表 |
| `/api/v1/artists/{id}/follow` | POST | 关注/取消关注 |
| `/api/v1/bookings` | POST | 创建预约 |
| `/api/v1/bookings` | GET | 我的预约列表 |

### 注意事项

1. **评分计算**：
   - rating = SUM(评分) / COUNT(评价)
   - 每次新增评价后异步更新

2. **状态管理**：
   - 妆师可自行设置接单状态
   - 排队中时需设置预计等待时间

3. **搜索优化**：
   - 支持按名称、风格搜索
   - 接入ES提升搜索体验

4. **预约流程**：
   - 预约后等待妆师确认
   - 确认后双方可私聊沟通细节
   - 完成后用户可评价
